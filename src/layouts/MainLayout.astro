---
import "../styles/global.css";
import SidebarProfile from "../components/SidebarProfile.astro";
import { SITE_LAST_UPDATED, type SiteLang } from "../lib/site";
import { withBase } from "../lib/path";

type Props = {
  lang: SiteLang;
  currentPath: string;
  pageTitle: string;
  pageDescription?: string;
};

const { lang, currentPath, pageTitle, pageDescription } = Astro.props;
const normalizedPath = currentPath || "/";
const localizedPath = normalizedPath.replace(/^\/en(?=\/|$)/, "") || "/";
const zhPath = localizedPath;
const enPath = localizedPath === "/" ? "/en" : `/en${localizedPath}`;
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription ?? "Academic personal website"} />
  </head>
  <body>
    <div class="page-topbar">
      <div class="lang-switch-group">
        <a href={withBase(zhPath, import.meta.env.BASE_URL)} class:list={["lang-switch", { active: lang === "zh" }]}>
          {"\u4e2d\u6587"}
        </a>
        <a href={withBase(enPath, import.meta.env.BASE_URL)} class:list={["lang-switch", { active: lang === "en" }]}>EN</a>
      </div>
    </div>
    <div class="site-shell">
      <aside class="site-sidebar">
        <SidebarProfile lang={lang} currentPath={currentPath} />
      </aside>
      <main class="site-main">
        <div class="site-content">
          <slot />
        </div>
      </main>
    </div>
    <footer class="site-footer">
      <p>{lang === "zh" ? `\u6700\u65b0\u66f4\u65b0\u65e5\u671f\uff1a${SITE_LAST_UPDATED}` : `Last updated: ${SITE_LAST_UPDATED}`}</p>
    </footer>
  </body>
</html>
